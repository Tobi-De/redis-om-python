
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Fastapi-users database adapter for TortoiseORM">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Models - RedisOM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#models-and-fields" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RedisOM" class="md-header__button md-logo" aria-label="RedisOM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RedisOM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RedisOM" class="md-nav__button md-logo" aria-label="RedisOM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RedisOM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Chapters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapters" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connections/" class="md-nav__link">
        Connections
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Models
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models-and-fields" class="md-nav__link">
    Models and Fields
  </a>
  
    <nav class="md-nav" aria-label="Models and Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashmodel-vs-jsonmodel" class="md-nav__link">
    HashModel vs. JsonModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-your-model" class="md-nav__link">
    Creating Your Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-models" class="md-nav__link">
    Configuring Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abstract-models" class="md-nav__link">
    Abstract Models
  </a>
  
    <nav class="md-nav" aria-label="Abstract Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-meta-object-is-special" class="md-nav__link">
    The Meta Object Is "Special"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all-settings-supported-by-the-meta-object" class="md-nav__link">
    All Settings Supported by the Meta Object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-hashmodel" class="md-nav__link">
    With HashModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-jsonmodel" class="md-nav__link">
    With JsonModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-values" class="md-nav__link">
    Default Values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marking-a-field-as-indexed" class="md-nav__link">
    Marking a Field as Indexed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redis_modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fastapi_integration/" class="md-nav__link">
        Fastapi
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models-and-fields" class="md-nav__link">
    Models and Fields
  </a>
  
    <nav class="md-nav" aria-label="Models and Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashmodel-vs-jsonmodel" class="md-nav__link">
    HashModel vs. JsonModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-your-model" class="md-nav__link">
    Creating Your Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-models" class="md-nav__link">
    Configuring Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abstract-models" class="md-nav__link">
    Abstract Models
  </a>
  
    <nav class="md-nav" aria-label="Abstract Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-meta-object-is-special" class="md-nav__link">
    The Meta Object Is "Special"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all-settings-supported-by-the-meta-object" class="md-nav__link">
    All Settings Supported by the Meta Object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    Fields
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-hashmodel" class="md-nav__link">
    With HashModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-jsonmodel" class="md-nav__link">
    With JsonModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-values" class="md-nav__link">
    Default Values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marking-a-field-as-indexed" class="md-nav__link">
    Marking a Field as Indexed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h2 id="models-and-fields">Models and Fields<a class="headerlink" href="#models-and-fields" title="Permanent link">&para;</a></h2>
<p>The heart of Redis OM's object mapping, validation, and querying features is a
pair of declarative models: <code>HashModel</code> and <code>JsonModel</code>. Both models work
provide roughly the same API, but they store data in Redis differently.</p>
<p>This page will explain how to create your Redis OM model by subclassing one of
these classes.</p>
<h3 id="hashmodel-vs-jsonmodel">HashModel vs. JsonModel<a class="headerlink" href="#hashmodel-vs-jsonmodel" title="Permanent link">&para;</a></h3>
<p>First, which should you use?</p>
<p>The choice is relatively simple. If you want to embed a model inside another
model, like giving a <code>Customer</code> model a list of <code>Order</code> models, then you need to
use <code>JsonModel</code>. Only <code>JsonModel</code> supports embedded models.</p>
<p>Otherwise, use <code>HashModel</code>.</p>
<h3 id="creating-your-model">Creating Your Model<a class="headerlink" href="#creating-your-model" title="Permanent link">&para;</a></h3>
<p>You create a Redis OM model by subclassing <code>HashModel</code> or <code>JsonModel</code>. For
example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
<h3 id="configuring-models">Configuring Models<a class="headerlink" href="#configuring-models" title="Permanent link">&para;</a></h3>
<p>There are several Redis OM-specific settings you can configure in models. You
configure these settings using a special object called the <em>Meta object</em>.</p>
<p>Here is an example of using the Meta object to set a global key prefix:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">global_key_prefix</span> <span class="o">=</span> <span class="s2">&quot;customer-dashboard&quot;</span>
</code></pre></div></td></tr></table></div>
<h3 id="abstract-models">Abstract Models<a class="headerlink" href="#abstract-models" title="Permanent link">&para;</a></h3>
<p>You can create abstract Redis OM models by subclassing <code>ABC</code> in addition to
either <code>HashModel</code> or <code>JsonModel</code>. Abstract models exist only to gather shared
configuration for subclasses -- you can't instantiate them.</p>
<p>One use of abstract models is to configure a Redis key prefix that all models in
your application will use. This is a good best practice with Redis. Here's how
you'd do it with an abstract model:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>

<span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">HashModel</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">global_key_prefix</span> <span class="o">=</span> <span class="s2">&quot;your-application&quot;</span>
</code></pre></div></td></tr></table></div>
<h4 id="the-meta-object-is-special">The Meta Object Is "Special"<a class="headerlink" href="#the-meta-object-is-special" title="Permanent link">&para;</a></h4>
<p>The Meta object has a special property: if you create a model subclass from a base class that has a Meta object, Redis OM copies the parent's fields into the Meta object in the child class.</p>
<p>Because of this, a subclass can override a single field in its parent's Meta class without having to redefine all fields.</p>
<p>An example will make this clearer:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>

<span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span><span class="p">,</span> <span class="n">get_redis_connection</span>


<span class="n">redis</span> <span class="o">=</span> <span class="n">get_redis_connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">6380</span><span class="p">)</span>
<span class="n">other_redis</span> <span class="o">=</span> <span class="n">get_redis_connection</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">6381</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">HashModel</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">global_key_prefix</span> <span class="o">=</span> <span class="s2">&quot;customer-dashboard&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">redis</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">other_redis</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">global_key_prefix</span><span class="p">)</span>
<span class="c1"># &gt; &quot;customer-dashboard&quot;</span>
</code></pre></div></td></tr></table></div>
<p>In this example, we created an abstract base model called <code>BaseModel</code> and gave it a Meta object containing a database connection and a global key prefix.</p>
<p>Then we created a subclass <code>BaseModel</code> called <code>Customer</code> and gave it a second Meta object, but only defined <code>database</code>. <code>Customer</code> <em>also gets the global key prefix</em> that <code>BaseModel</code> defined ("customer-dashboard").</p>
<p>While this is not how object inheritance usually works in Python, we think it is helpful to make abstract models more useful, especially as a way to group shared model settings.</p>
<h4 id="all-settings-supported-by-the-meta-object">All Settings Supported by the Meta Object<a class="headerlink" href="#all-settings-supported-by-the-meta-object" title="Permanent link">&para;</a></h4>
<p>Here is a table of the settings available in the Meta object and what they control.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>global_key_prefix</td>
<td>A string prefix applied to every Redis key that the model manages. This could be something like your application's name.</td>
<td>""</td>
</tr>
<tr>
<td>model_key_prefix</td>
<td>A string prefix applied to the Redis key representing every model. For example, the Redis Hash key for a HashModel. This prefix is also added to the redisearch index created for every model with indexed fields.</td>
<td>""</td>
</tr>
<tr>
<td>primary_key_pattern</td>
<td>A format string producing the base string for a Redis key representing this model. This string should accept a "pk" format argument. <strong>Note:</strong> This is a "new style" format string, which will be called with <code>.format()</code>.</td>
<td>"{pk}"</td>
</tr>
<tr>
<td>database</td>
<td>An aioredis.Redis or redis.Redis client instance that the model will use to communicate with Redis.</td>
<td>A new instance created with connections.get_redis_connection().</td>
</tr>
<tr>
<td>primary_key_creator_cls</td>
<td>A class that adheres to the PrimaryKeyCreator protocol, which Redis OM will use to create a primary key for a new model instance.</td>
<td>UlidPrimaryKey</td>
</tr>
<tr>
<td>index_name</td>
<td>The RediSearch index name to use for this model. Only used if at least one of the model's fields are marked as indexable (<code>index=True</code>).</td>
<td>"{global_key_prefix}:{model_key_prefix}:index"</td>
</tr>
<tr>
<td>embedded</td>
<td>Whether or not this model is "embedded." Embedded models are not included in migrations that create and destroy indexes. Instead, their indexed fields are included in the index for the parent model. <strong>Note</strong>: Only <code>JsonModel</code> can have embedded models.</td>
<td>False</td>
</tr>
<tr>
<td>encoding</td>
<td>The default encoding to use for strings. This encoding is given to redis-py or aioredis at the connection level. In both cases, Redis OM will decode binary strings from Redis using your chosen encoding.</td>
<td>"utf-8"</td>
</tr>
<tr>
<td>## Configuring Pydantic</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Every Redis OM model is also a Pydantic model, so in addition to configuring Redis OM behavior with the Meta object, you can control Pydantic configuration via the Config object within a model class.</p>
<p>See the <a href="https://pydantic-docs.helpmanual.io/usage/model_config/">Pydantic documentation for details</a> on how this object works and the settings that are available.</p>
<p>The default Pydantic configuration for models, which Redis OM sets for you, is equivalent to the following (demonstrated on an actual model):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="c1"># ... Fields ...</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;allow&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Some features may not work correctly if you change these settings.</p>
<h3 id="fields">Fields<a class="headerlink" href="#fields" title="Permanent link">&para;</a></h3>
<p>You define fields on a Redis OM model using Python <em>type annotations</em>. If you
aren't familiar with type annotations, check out this
<a href="https://towardsdatascience.com/type-annotations-in-python-d90990b172dc">tutorial</a>.</p>
<p>This works exactly the same way as it does with Pydantic. Check out the <a href="https://pydantic-docs.helpmanual.io/usage/types/">Pydantic documentation on field types</a> for guidance.</p>
<h4 id="with-hashmodel">With HashModel<a class="headerlink" href="#with-hashmodel" title="Permanent link">&para;</a></h4>
<p><code>HashModel</code> stores data in Redis Hashes, which are flat. This means that a Redis Hash can't contain a Redis Set, List, or Hash. Because of this requirement, <code>HashModel</code> also does not currently support container types, such as:</p>
<ul>
<li>Sets</li>
<li>Lists</li>
<li>Dictionaries and other "mapping" types</li>
<li>Other Redis OM models</li>
<li>Pydantic models</li>
</ul>
<p><strong>NOTE</strong>: In the future, we may serialize these values as JSON strings, the same way we do for <code>JsonModel</code>. The difference would be that in the case of <code>HashModel</code>, you wouldn't be able to index these fields, just get and save them with the model. With <code>JsonModel</code>, you can index list fields and embedded <code>JsonModel</code>s.</p>
<p>So, in short, if you want to use container types, use <code>JsonModel</code>.</p>
<h4 id="with-jsonmodel">With JsonModel<a class="headerlink" href="#with-jsonmodel" title="Permanent link">&para;</a></h4>
<p>Good news! Container types <em>are</em> supported with <code>JsonModel</code>.</p>
<p>We will use Pydantic's JSON serialization and encoding to serialize your <code>JsonModel</code> and save it in Redis.</p>
<h4 id="default-values">Default Values<a class="headerlink" href="#default-values" title="Permanent link">&para;</a></h4>
<p>Fields can have default values. You set them by assigning a value to a field.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">join_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Super dope&quot;</span>  <span class="c1"># &lt;- We added a default here</span>
</code></pre></div></td></tr></table></div>
<p>Now, if we create a <code>Customer</code> object without a <code>bio</code> field, it will use the default value.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="n">HashModel</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">join_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Super dope&quot;</span>


<span class="n">andrew</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span>
    <span class="n">first_name</span><span class="o">=</span><span class="s2">&quot;Andrew&quot;</span><span class="p">,</span>
    <span class="n">last_name</span><span class="o">=</span><span class="s2">&quot;Brookins&quot;</span><span class="p">,</span>
    <span class="n">email</span><span class="o">=</span><span class="s2">&quot;andrew.brookins@example.com&quot;</span><span class="p">,</span>
    <span class="n">join_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
    <span class="n">age</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>  <span class="c1"># &lt;- Notice, we didn&#39;t give a bio!</span>

<span class="nb">print</span><span class="p">(</span><span class="n">andrew</span><span class="o">.</span><span class="n">bio</span><span class="p">)</span>  <span class="c1"># &lt;- So we got the default value.</span>
<span class="c1"># &gt; &#39;Super Dope&#39;</span>
</code></pre></div></td></tr></table></div>
<p>The model will then save this default value to Redis the next time you call <code>save()</code>.</p>
<h3 id="marking-a-field-as-indexed">Marking a Field as Indexed<a class="headerlink" href="#marking-a-field-as-indexed" title="Permanent link">&para;</a></h3>
<p>If you're using the RediSearch module in your Redis instance, you can mark a field as "indexed." As soon as you mark any field in a model as indexed, Redis OM will automatically create and manage an secondary index for the model for you, allowing you to query on any indexed field.</p>
<p>To mark a field as indexed, you need to use the Redis OM <code>Field()</code> helper, like this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Field</span><span class="p">,</span>
    <span class="n">HashModel</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">HashModel</span><span class="p">):</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, we marked <code>Customer.last_name</code> as indexed.</p>
<p>To create the indexes for any models that have indexed fields, use the <code>migrate</code> CLI command that Redis OM installs in your Python environment.</p>
<p>This command detects any <code>JsonModel</code> or <code>HashModel</code> instances in your project and does the following for each model that isn't abstract or embedded:</p>
<ul>
<li>If no index exists yet for the model:</li>
<li>The migrator creates an index</li>
<li>The migrator stores a hash of the index definition</li>
<li>If an index exists for the model:</li>
<li>The migrator checks if the stored hash for the index is out of date</li>
<li>If the stored hash is out of date, the migrator drops the index (not your data!) and rebuilds it with the new index definition</li>
</ul>
<p>You can also run the <code>Migrator</code> yourself with code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">redis_om</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_redis_connection</span><span class="p">,</span>
    <span class="n">Migrator</span>
<span class="p">)</span>

<span class="n">redis</span> <span class="o">=</span> <span class="n">get_redis_connection</span><span class="p">()</span>
<span class="n">Migrator</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../connections/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Connections" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Connections
            </div>
          </div>
        </a>
      
      
        
        <a href="../validation/" class="md-footer__link md-footer__link--next" aria-label="Next: Validation" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Validation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>